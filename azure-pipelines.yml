# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pr:
- master

pool:
  vmImage: 'macOS 10.13'

steps:
- bash: |
    brew tap osx-cross/avr
    cd $(brew --repo)/Library/Taps/osx-cross/homebrew-avr
    git checkout --detach
    git fetch origin '+refs/heads/*:refs/heads/*'
    git checkout --track origin/azure-pipeline
  displayName: Checkout and change branch
  env:
    HOMEBREW_NO_ANALYTICS: 1
    HOMEBREW_NO_AUTO_UPDATE: 1

- bash: |
    brew audit --strict avr-binutils
    brew install avr-binutils
    brew test avr-binutils
  displayName: Audit, build & test avr-binutils
  timeoutInMinutes: 360
  env:
    HOMEBREW_NO_ANALYTICS: 1
    HOMEBREW_NO_AUTO_UPDATE: 1

- bash: |
    brew audit --strict avr-gcc
    brew install avr-gcc
    brew test avr-gcc
  displayName: Audit, build & test avr-gcc
  timeoutInMinutes: 360
  env:
    HOMEBREW_NO_ANALYTICS: 1
    HOMEBREW_NO_AUTO_UPDATE: 1
